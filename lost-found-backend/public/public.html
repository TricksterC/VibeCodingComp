<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Lost & Found</title>
</head>
<body>
  <h1>Upload Lost/Found Item</h1>
  <form id="uploadForm" enctype="multipart/form-data">
    <input type="text" name="title" placeholder="Item title" required><br><br>
    <input type="text" name="description" placeholder="Description" required><br><br>
    <select name="status" required>
      <option value="lost">Lost</option>
      <option value="found">Found</option>
    </select><br><br>
    <input type="file" name="image" accept="image/*" required><br><br>
    <button type="submit">Upload</button>
  </form>

  <h2>Response</h2>
  <pre id="response"></pre>

  <h2>All Items</h2>
  <div id="itemsList"></div>

  <script>
    const API_BASE = "http://localhost:5000";

    async function fetchItems() {
      try {
        const res = await fetch(`${API_BASE}/items`);
        if (!res.ok) throw new Error("Failed to fetch items");
        const items = await res.json();

        const itemsList = document.getElementById("itemsList");
        itemsList.innerHTML = "";

        if (items.length === 0) {
          itemsList.textContent = "No items uploaded yet.";
          return;
        }

        items.forEach(item => {
          const div = document.createElement("div");
          div.style.border = "1px solid #ccc";
          div.style.padding = "10px";
          div.style.margin = "10px 0";
          div.innerHTML = `
            <strong>${item.title}</strong> (${item.status})<br>
            ${item.description}<br>
            <img src="${item.imageUrl}" alt="${item.title}" style="max-width:200px;margin-top:5px;">
          `;
          itemsList.appendChild(div);
        });
      } catch (err) {
        document.getElementById("itemsList").textContent = "Error loading items.";
      }
    }

    document.getElementById("uploadForm").addEventListener("submit", async (e) => {
      e.preventDefault();
  
      const responseBox = document.getElementById("response");
      responseBox.textContent = "Uploading...";
  
      try {
        const formData = new FormData(e.target);
        const res = await fetch(`${API_BASE}/upload`, {
          method: "POST",
          body: formData
        });
  
        if (!res.ok) throw new Error(`Server error: ${res.status} ${res.statusText}`);
  
        const data = await res.json();
        responseBox.textContent = JSON.stringify(data, null, 2);
        fetchItems(); // refresh list after upload
  
      } catch (err) {
        responseBox.textContent = `Error: ${err.message}`;
      }
    });

    // Load items on page load
    fetchItems();
  </script>
</body>
</html>
